<!DOCTYPE html>
<html lang="id" class="dark">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Note Keeper</title>
  <script>
    tailwind.config = {
      darkMode: 'class'
    }
  </script>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap');
    body {
      font-family: 'Poppins', sans-serif;
    }
  </style>
</head>
<body class="bg-gray-900 text-white min-h-screen p-6">

  <div class="max-w-7xl mx-auto space-y-8">

    <!-- Header -->
    <div class="flex items-center justify-between">
      <h1 class="text-3xl font-bold text-blue-300">📒 Catatan Harian</h1>
    </div>

    <!-- Grid Layout -->
    <div class="grid md:grid-cols-3 gap-6">

      <!-- Kolom 1: Tambah/Edit -->
      <div class="bg-gray-800 p-6 rounded-xl shadow space-y-4">
        <h2 class="text-xl font-semibold text-blue-300">✍️ Tambah / Edit Catatan</h2>
        <textarea id="noteInput" rows="4" placeholder="Contoh: Belajar Tailwind..."
          class="w-full p-3 border border-gray-600 rounded-lg bg-gray-700 text-white"></textarea>
        <button onclick="simpanCatatan()"
          class="w-full bg-blue-600 text-white py-2 rounded-lg hover:bg-blue-700 transition">Simpan Catatan</button>
      </div>

      <!-- Kolom 2: Cari & Aksi -->
      <div class="bg-gray-800 p-6 rounded-xl shadow space-y-4">
        <h2 class="text-xl font-semibold text-green-300">🔍 Cari & Aksi</h2>
        <input type="text" id="searchCommand" placeholder="Ketik kata kunci..."
          class="w-full p-3 border border-gray-600 rounded-lg bg-gray-700 text-white" />

        <div>
          <label for="sortOption" class="block mb-1">Urutkan Berdasarkan:</label>
          <select id="sortOption"
            class="w-full p-2 border border-gray-600 rounded-lg bg-gray-700 text-white">
            <option value="latest">Tanggal Terbaru</option>
            <option value="oldest">Tanggal Terlama</option>
            <option value="az">A-Z</option>
            <option value="za">Z-A</option>
          </select>
        </div>

        <div class="flex gap-2">
          <button onclick="cariCatatan()"
            class="w-full bg-green-600 text-white py-2 rounded-lg hover:bg-green-700 transition">Tampilkan</button>
          <button onclick="hapusSemuaCatatan()"
            class="w-full bg-red-600 text-white py-2 rounded-lg hover:bg-red-700 transition">Hapus Semua</button>
        </div>

        <div>
          <h3 class="font-semibold mt-4 mb-2">📋 Hasil:</h3>
          <ul id="outputList" class="space-y-2 text-sm"></ul>
        </div>
      </div>

      <!-- Kolom 3: Export / Import -->
      <div class="bg-gray-800 p-6 rounded-xl shadow space-y-4">
        <h2 class="text-xl font-semibold text-yellow-400">📂 Export / Import CSV</h2>
        <button onclick="exportCSV()"
          class="w-full bg-yellow-500 text-white py-2 rounded-lg hover:bg-yellow-600 transition">Export CSV</button>

        <input type="file" id="csvFile" accept=".csv"
          class="w-full p-2 mt-2 border border-gray-600 rounded-lg bg-gray-700 text-sm text-white" />
        <button onclick="importCSV()"
          class="w-full bg-indigo-600 text-white py-2 rounded-lg hover:bg-indigo-700 transition">Import CSV</button>
      </div>
    </div>
  </div>

  <!-- Suara -->
  <audio id="soundSave" src="https://cdn.pixabay.com/audio/2022/03/15/audio_16b30301cd.mp3"></audio>
  <audio id="soundEdit" src="https://cdn.pixabay.com/audio/2022/11/24/audio_b1898c6ce0.mp3"></audio>
  <audio id="soundDelete" src="https://cdn.pixabay.com/audio/2022/03/15/audio_f1c4b2cf84.mp3"></audio>

  <script>
    let editIndex = null;

    function simpanCatatan() {
      const input = document.getElementById('noteInput').value.trim();
      if (!input) return alert("Catatan tidak boleh kosong!");
      let notes = JSON.parse(localStorage.getItem('notes')) || [];
      const timestamp = new Date().toISOString();

      if (editIndex !== null) {
        notes[editIndex] = { text: input, time: timestamp };
        document.getElementById('soundEdit').play();
        alert("Catatan diperbarui!");
        editIndex = null;
      } else {
        notes.push({ text: input, time: timestamp });
        document.getElementById('soundSave').play();
        alert("Catatan disimpan!");
      }

      localStorage.setItem('notes', JSON.stringify(notes));
      document.getElementById('noteInput').value = '';
    }

    function cariCatatan() {
      const keyword = document.getElementById('searchCommand').value.toLowerCase();
      const sortOption = document.getElementById('sortOption').value;
      const output = document.getElementById('outputList');
      output.innerHTML = "";

      let notes = JSON.parse(localStorage.getItem('notes')) || [];
      let hasil = notes.map((n, i) => ({ ...n, index: i }))
        .filter(n => n.text.toLowerCase().includes(keyword));

      switch (sortOption) {
        case 'latest': hasil.sort((a, b) => new Date(b.time) - new Date(a.time)); break;
        case 'oldest': hasil.sort((a, b) => new Date(a.time) - new Date(b.time)); break;
        case 'az': hasil.sort((a, b) => a.text.localeCompare(b.text)); break;
        case 'za': hasil.sort((a, b) => b.text.localeCompare(a.text)); break;
      }

      if (!hasil.length) {
        output.innerHTML = "<li class='text-red-400'>Tidak ada catatan yang cocok.</li>";
        return;
      }

      hasil.forEach(item => {
        const li = document.createElement("li");
        li.className = "bg-gray-700 p-3 rounded-lg shadow-sm flex justify-between items-start";

        const content = document.createElement("div");
        content.className = "flex-1";
        content.innerHTML = `<p>${item.text}</p><small class="text-gray-400 text-xs">🕒 ${new Date(item.time).toLocaleString()}</small>`;

        const actions = document.createElement("div");
        actions.className = "flex gap-2 ml-3";

        const editBtn = document.createElement("button");
        editBtn.textContent = "✏️";
        editBtn.onclick = () => editCatatan(item.index);

        const delBtn = document.createElement("button");
        delBtn.textContent = "❌";
        delBtn.onclick = () => hapusCatatan(item.index);

        actions.appendChild(editBtn);
        actions.appendChild(delBtn);
        li.appendChild(content);
        li.appendChild(actions);
        output.appendChild(li);
      });
    }

    function editCatatan(index) {
      const notes = JSON.parse(localStorage.getItem('notes')) || [];
      document.getElementById('noteInput').value = notes[index].text;
      editIndex = index;
    }

    function hapusCatatan(index) {
      let notes = JSON.parse(localStorage.getItem('notes')) || [];
      notes.splice(index, 1);
      localStorage.setItem('notes', JSON.stringify(notes));
      document.getElementById('soundDelete').play();
      alert("Catatan dihapus.");
      cariCatatan();
    }

    function hapusSemuaCatatan() {
      if (confirm("Yakin ingin menghapus semua catatan?")) {
        localStorage.removeItem('notes');
        document.getElementById('outputList').innerHTML = "";
        document.getElementById('soundDelete').play();
        alert("Semua catatan telah dihapus.");
      }
    }

    function exportCSV() {
      const notes = JSON.parse(localStorage.getItem('notes')) || [];
      if (!notes.length) return alert("Tidak ada catatan.");
      let csv = "data:text/csv;charset=utf-8,Catatan,Waktu\n";
      notes.forEach(n => {
        csv += `"${n.text.replace(/"/g, '""')}","${new Date(n.time).toLocaleString()}"\n`;
      });
      const link = document.createElement("a");
      link.href = encodeURI(csv);
      link.download = "catatan.csv";
      link.click();
    }

    function importCSV() {
      const file = document.getElementById("csvFile").files[0];
      if (!file) return alert("Pilih file CSV.");
      const reader = new FileReader();
      reader.onload = function (e) {
        const lines = e.target.result.trim().split("\n").slice(1);
        const imported = lines.map(line => {
          const [text, time] = line.split(/,(.+)/);
          return { text: text.replace(/^"|"$/g, '').replace(/""/g, '"'), time: new Date(time).toISOString() };
        });
        const existing = JSON.parse(localStorage.getItem('notes')) || [];
        localStorage.setItem('notes', JSON.stringify([...existing, ...imported]));
        alert("Berhasil diimpor!");
      };
      reader.readAsText(file);
    }
  </script>

</body>
</html>
